# StockGravity 최적화 계획

## 현재 문제점

### 병목구간 분석
1. **수급 데이터 수집**: 5시간 14분 (전체의 87%)
   - 2790개 종목 순차 처리
   - 멀티프로세싱 미사용
   - 종목당 6.7초 소요

2. **불필요한 데이터 수집**
   - 2790개 전체 종목 수집
   - 결과: Score 80점 이상은 57개 (2%)만 유의미

## 최적화 방안

### 📌 Phase 1: 2단계 파이프라인 (추천)
```
1단계: 빠른 시세 데이터 수집 (전체)
   ↓
   기초 기술적 분석 (MA, 거래량, 등락률)
   ↓
   유망 종목 필터링 (상위 500개)
   ↓
2단계: 수급 데이터 수집 (필터링된 종목만)
   ↓
   상세 분석
```

**효과**:
- 수집 종목: 2790개 → 500개 (82% 감소)
- 수집 시간: 5.2시간 → 56분 (82% 단축)
- 전체 시간: 6시간 → 1.2시간

### 📌 Phase 2: 멀티프로세싱 적용
```python
# all_institutional_trend_data.py 수정
- 현재: for loop (순차)
- 개선: multiprocessing.Pool (병렬)
```

**효과**:
- 8코어 사용 시: 500개 × 6.7초 / 8 = 7분
- 추가 시간 단축: 56분 → 7분

### 📌 Phase 3: 필터링 기준 강화

**기초 필터링 조건**:
1. 거래량 > 평균 거래량의 50%
2. 시가총액 > 100억
3. 최근 5일 등락률 > -10%
4. 유동성 있는 종목만 (일 거래대금 > 1억)

**예상 필터링 결과**: 2790 → 500~800개

### 📌 Phase 4: 점진적 데이터 수집

**일일 업데이트 모드**:
```
최초: 전체 데이터 수집 (1회, 1-2시간)
이후: 증분 업데이트만 수집 (5-10분)
  - 기존 유망 종목: 최신 데이터만
  - 신규 진입 종목: 전체 데이터
```

## 구현 우선순위

### 🚀 즉시 적용 가능 (Phase 1)
1. **빠른 필터링 스크립트 작성**
   - `quick_filter.py`: 시세 데이터만으로 유망 종목 선별
   - 실행 시간: ~1분

2. **수급 데이터 수집 대상 축소**
   - `all_institutional_trend_data.py` 수정
   - 필터링된 종목 리스트만 처리

### ⚡ 단기 개선 (Phase 2)
3. **멀티프로세싱 적용**
   - `all_institutional_trend_data.py` 리팩토링
   - `create_complete_daily_prices.py` 구조 참고

### 🎯 중기 개선 (Phase 3 & 4)
4. **스마트 필터링**
5. **증분 업데이트 시스템**

## 예상 효과

| 단계 | 현재 | Phase 1 | Phase 2 | Phase 3 |
|------|------|---------|---------|---------|
| 수집 종목 | 2790개 | 500개 | 500개 | 300개 |
| 수급 수집 | 5.2시간 | 56분 | 7분 | 4분 |
| 전체 시간 | 6시간 | 1.2시간 | 30분 | 25분 |
| 시간 단축 | - | 80% | 92% | 93% |

## 실행 방법

### 즉시 적용 (Phase 1)
```bash
# 1. 빠른 필터링 실행
python quick_filter.py --min-volume 1000000 --top 500

# 2. 필터링된 종목만 수급 수집
python all_institutional_trend_data.py --filtered-only

# 3. 분석 실행
python analysis2.py
python investigate_top_stocks.py
```

### 예상 시간
- 필터링: 1분
- 시세 수집: 17분
- 수급 수집: 56분 (500개) → 7분 (멀티프로세싱)
- 분석: 4분
- **총: 약 30분** (현재 6시간 대비 92% 단축)

## 결론

**핵심 인사이트**:
> 2790개 종목 중 실제로 유망한 종목은 50-100개
> → 전체 데이터 수집은 낭비

**추천 전략**:
1. 즉시: Phase 1 적용 (80% 시간 단축)
2. 단기: Phase 2 추가 (92% 시간 단축)
3. 장기: 증분 업데이트로 일일 5분 실행

**투자 대비 효과**:
- 개발 시간: 2-3시간
- 시간 절감: 매회 5.5시간 → 누적 효과 大
